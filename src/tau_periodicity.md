# Periodicity of Green's functions in imaginary time

$$
\newcommand{\iv}{{\mathrm{i}\nu}}
\newcommand{\dd}{{\mathrm{d}}}
$$

This note explains how sparse-ir handles the periodicity of imaginary-time Green's functions, including the treatment of boundary points.

## Periodicity rules

Green's functions in imaginary time satisfy periodicity conditions that depend on statistics:

**Fermions (anti-periodic):**

$$
G(\tau + \beta) = -G(\tau)
$$

**Bosons (periodic):**

$$
G(\tau + \beta) = G(\tau)
$$

These conditions arise from the trace over the thermal density matrix and the (anti-)commutation relations of the operators.

## Standard domain: $\tau \in [0, \beta]$

The standard domain for imaginary time is $\tau \in [0, \beta]$. Within this interval, the Green's function is well-defined and the boundary values satisfy:

$$
G(0^+) = \mp G(\beta^-) \quad \text{(upper sign: fermion, lower: boson)}
$$

where $0^+$ and $\beta^-$ denote limits from above and below, respectively.

## Extended domain: $\tau \in [-\beta, \beta]$

For numerical convenience, sparse-ir supports the extended domain $\tau \in [-\beta, \beta]$.
Values in the negative range $\tau \in [-\beta, 0)$ are mapped to $[0, \beta]$ using the periodicity relation:

$$
G(\tau) = \zeta \cdot G(\tau + \beta) \quad \text{for } \tau < 0
$$

where $\zeta = -1$ for fermions and $\zeta = +1$ for bosons.

## Special treatment of boundary points

### The $\tau = 0$ boundary

The point $\tau = 0$ requires special care due to the discontinuity in fermionic Green's functions.
In IEEE 754 floating-point arithmetic, there are two representations of zero: $+0$ and $-0$.
sparse-ir uses this to distinguish the limits:

| Value | Interpretation | Mapped to |
|-------|---------------|-----------|
| $+0.0$ | $\tau = 0^+$ (from above) | $\tau = 0$ |
| $-0.0$ | $\tau = 0^-$ (from below) | $\tau = \beta$ |

This convention is consistent with the periodicity relation:
- $G(0^-) = G(-\epsilon \to 0) = \zeta \cdot G(\beta - \epsilon) = \zeta \cdot G(\beta^-)$

### Implementation: `normalize_tau`

The function `normalize_tau` (available in both Python and Julia) handles this mapping:

```python
from sparse_ir._util import normalize_tau

beta = 10.0

# Positive zero: τ = 0⁺
tau_norm, sign = normalize_tau('F', +0.0, beta)
# tau_norm = 0.0, sign = +1.0

# Negative zero: τ = 0⁻ → τ = β with sign flip (fermion)
tau_norm, sign = normalize_tau('F', -0.0, beta)
# tau_norm = 10.0, sign = -1.0

# Negative tau: τ = -3 → τ = 7 with sign flip (fermion)
tau_norm, sign = normalize_tau('F', -3.0, beta)
# tau_norm = 7.0, sign = -1.0

# Bosonic case: no sign flip
tau_norm, sign = normalize_tau('B', -3.0, beta)
# tau_norm = 7.0, sign = +1.0
```

## Sampling points: language-specific conventions

The default tau sampling points are generated differently across language implementations:

### Python / Julia: $[0, \beta]$ range

For backward compatibility with existing codes, the Python (`sparse-ir`) and Julia (`SparseIR.jl`) implementations generate sampling points in the standard domain $[0, \beta]$:

```python
import sparse_ir

basis = sparse_ir.FiniteTempBasis('F', beta=10, wmax=5)
points = basis.default_tau_sampling_points()
# All points in [0, β], sorted in ascending order
```

The `use_positive_taus` parameter controls this behavior:
- `use_positive_taus=True` (default): Points are folded to $[0, \beta]$ using $\tau \mapsto \tau \mod \beta$
- `use_positive_taus=False`: Points are returned as generated by the backend (symmetric around $\beta/2$)

### Rust: $[-\beta/2, \beta/2]$ range

The Rust backend (`sparse-ir-rs`) natively generates sampling points in the symmetric range $[-\beta/2, \beta/2]$.
This convention is chosen with future extensions in mind:

- **Absolute zero limit**: As $\beta \to \infty$, the domain naturally extends to $(-\infty, \infty)$

The Python/Julia wrappers automatically convert these points to $[0, \beta]$ when `use_positive_taus=True`.

## Summary

| Concept | Fermion | Boson |
|---------|---------|-------|
| Periodicity | $G(\tau+\beta) = -G(\tau)$ | $G(\tau+\beta) = G(\tau)$ |
| Sign factor $\zeta$ | $-1$ | $+1$ |
| $-0.0$ maps to | $(\beta, -1)$ | $(\beta, +1)$ |
| Negative $\tau$ maps to | $(\tau+\beta, -1)$ | $(\tau+\beta, +1)$ |

This handling ensures consistent evaluation of Green's functions across the extended domain while maintaining proper periodicity conditions.

## References

For more details on imaginary-time Green's functions and their properties, see:
- The [Green's function and Lehmann representation](greens_function) page
- The [Summation over Matsubara axis](matsubarasum) note for related boundary considerations
